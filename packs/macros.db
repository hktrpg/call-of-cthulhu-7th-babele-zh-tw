{"_id":"DUReiLuGAJSUYMSK","name":"向KP 暗骰","type":"script","sort":100001,"flags":{"exportSource":{"world":"HKTRPG","system":"CoC7","coreVersion":"0.8.8","systemVersion":"0.6.1"}},"scope":"global","command":"let users = game.users.filter(user => user.active && user.isGM);\nvar targets = [];\nfor (let user of users) {\ntargets.push(user.id);\n}\nChatMessage.create({\ncontent:'暗骰進行中'\n\n});\nChatMessage.create({\ncontent:'[[1d100]]',\nwhisper:targets\n});","author":"50b5eHkr4RuPl9HN","img":"icons/dice/d10black.svg","actorIds":[]}
{"_id":"J9RE3U4FuK7K7CBG","name":"私訊某人","type":"script","sort":100001,"flags":{"exportSource":{"world":"HKTRPG","system":"CoC7","coreVersion":"0.8.8","systemVersion":"0.6.1"}},"scope":"global","command":"//私訊他人\n/** \n * Provides a dialog to whisper specific players. If you have tokens selected, it will automatically default to try and whisper those players.\n * @Author:Nelson#3570\n */\n\nlet applyChanges = false;\n\nlet users = game.users.filter(user => user.active);\nlet checkOptions = \"\"\nlet playerTokenIds = users.map(u => u.character?.id).filter(id => id !== undefined);\nlet selectedPlayerIds = canvas.tokens.controlled.map(token => {\nif (playerTokenIds.includes(token.actor.id)) return token.actor.id;\n});\n\n// Build checkbox list for all active players\nusers.forEach(user => {\nlet checked = !!user.character && selectedPlayerIds.includes(user.character.id) && 'checked';\ncheckOptions += `\n<br>\n<input type=\"checkbox\" name=\"${user.id}\" id=\"${user.id}\" value=\"${user.name}\" ${checked}>\\n\n<label for=\"${user.id}\">${user.name}</label>\n  `\n});\n\nnew Dialog({\ntitle:\"Whisper\",\ncontent:`私訊對像: ${checkOptions} <br>\n<label for=\"message\">Message:</label>\n<textarea id=\"message\" name=\"message\" rows=\"4\" cols=\"50\"></textarea><br>擲骰格式[[1d100]]<br>`,\nbuttons:{\nwhisper:{\nlabel:\"進行私訊\",\ncallback:(html) => createMessage(html)\n}\n}\n}).render(true);\n\nfunction createMessage(html) {\nvar targets = [];\nconsole.log(html)\n// build list of selected players ids for whispers target\nfor (let user of users) {\nif (html.find('[name=\"' + user.id + '\"]')[0].checked) {\napplyChanges = true;\ntargets.push(user.id);\n}\nvar messageText = html.find('[name=\"message\"]')[0].value\n}\nif (!applyChanges) return;\nChatMessage.create({\ncontent:'正在向某人低語'\n});\nChatMessage.create({\ncontent:messageText,\nwhisper:targets\n});\n}","author":"50b5eHkr4RuPl9HN","img":"icons/svg/deaf.svg","actorIds":[]}
{"_id":"SH26logBCpbN4TVn","name":"向KP低語","type":"script","sort":100001,"flags":{"exportSource":{"world":"","system":"CoC7","coreVersion":"0.8.8","systemVersion":"0.6.1"}},"scope":"global","command":"let users = game.users.filter(user => user.active && user.isGM);\nnew Dialog({\ntitle:\"Whisper\",\ncontent:`<label for=\"message\">Message:</label>\n<textarea id=\"message\" name=\"message\" rows=\"4\" cols=\"50\"></textarea><br>擲骰格式[[1d100]]<br>`,\nbuttons:{\nwhisper:{\nlabel:\"進行私訊\",\ncallback:(html) => createMessage(html)\n}\n}\n}).render(true);\n\nfunction createMessage(html) {\nvar targets = [];\n// build list of selected players ids for whispers target\nfor (let user of users) {\ntargets.push(user.id);\nvar messageText = html.find('[name=\"message\"]')[0].value\n}\n\nChatMessage.create({\ncontent:'正在向KP低語'\n});\n\nChatMessage.create({\ncontent:messageText,\nwhisper:targets\n});\n}","author":"50b5eHkr4RuPl9HN","img":"icons/svg/silenced.svg","actorIds":[]}
{"_id":"zhoqYn4WGVqGMwwx","name":"心理學暗骰","type":"script","sort":100001,"flags":{"exportSource":{"world":"","system":"CoC7","coreVersion":"0.8.8","systemVersion":"0.6.1"}},"scope":"global","command":"let applyChanges = false;\nlet GM = game.users.filter(user => user.active && user.isGM);\nlet users = []\ngame.actors.forEach(user => user.items.forEach(a => {\nif (a.name == \"心理學\") {\nusers.push(user)\n}\n}));\nlet checkOptions = \"\"\nlet selectedPlayerIds = canvas.tokens.controlled.map(token => {\nreturn token.actor.id;\n});\n// Build checkbox list for all active players\nusers.forEach(user => {\nlet checked = selectedPlayerIds.includes(user.id) && 'checked';\ncheckOptions += `\n<br>\n<input type=\"checkbox\" name=\"${user.id}\" id=\"${user.id}\" value=\"${user.name}\" ${checked}>\\n\n<label for=\"${user.id}\">${user.name}</label>\n  `\n});\n\nnew Dialog({\ntitle:\"心理學\",\ncontent:`心理學使用者: ${checkOptions} <br>\n   `,\nbuttons:{\nwhisper:{\nlabel:\"進行心理學\",\ncallback:(html) => createMessage(html)\n}\n}\n}).render(true);\n\nfunction createMessage(html) {\nvar targets = [];\nvar messageText = '進行心理學暗骰<hr>'\n// build list of selected players ids for whispers target\nfor (let user of users) {\nif (html.find('[name=\"' + user.id + '\"]')[0].checked) {\nuser.items.forEach(a => {\nif (a.name == \"心理學\") {\napplyChanges = true;\nlet roll = new Roll(\"1d100\").roll().total\nif (roll <= a.base) //stuff\nmessageText += user.name + ' <span style=\"outline:2px double  blue;\">成功</span><br>' + '目標值: <span style=\"outline:1px solid  black;\">' + a.base + '</span> vs 結果: <span style=\"outline:1px solid  black;\">' + roll + '</span><br>' + '<hr>';\nelse {\nmessageText += user.name + ' <span style=\"outline: 2px double  red;\">失敗</span><br>' + '目標值:<span style=\"outline:1px solid  black;\">' + a.base + '</span> vs 結果: <span style=\"outline:1px solid  red;\">' + roll + '</span><br>' + '<hr>';\n}\n}\n})\n}\n}\nif (!applyChanges) return;\nChatMessage.create({\ncontent:'正在心理學暗骰'\n});\nChatMessage.create({\ncontent:messageText,\nwhisper:GM\n});\n}","author":"50b5eHkr4RuPl9HN","img":"icons/svg/heal.svg","actorIds":[]}
